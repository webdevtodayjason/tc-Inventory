{% extends "base.html" %}

{% block title %}{% if is_new %}New Wiki Page{% else %}Edit Wiki Page{% endif %}{% endblock %}

{% block head %}
<!-- TinyMCE -->
<script src="https://cdn.tiny.cloud/1/{{ config.get('TINYMCE_API_KEY') }}/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
    tinymce.init({
        selector: '#content',
        height: 500,
        plugins: [
            'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
            'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
            'insertdatetime', 'media', 'table', 'help', 'wordcount', 'codesample'
        ],
        toolbar: 'undo redo | styles | bold italic underline strikethrough | ' +
                'alignleft aligncenter alignright alignjustify | ' +
                'bullist numlist outdent indent | link image codesample | ' +
                'removeformat | help',
        menubar: 'file edit view insert format tools table help',
        content_style: `
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                font-size: 16px;
                line-height: 1.6;
                color: #333;
                max-width: 900px;
                margin: 0 auto;
                padding: 1rem;
            }
            p { margin: 0 0 1rem 0; }
            table { border-collapse: collapse; }
            table td, table th { border: 1px solid #ccc; padding: 0.4rem; }
            pre { background: #f4f4f4; padding: 1rem; border-radius: 4px; }
            img { max-width: 100%; height: auto; }
        `,
        skin: (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'oxide-dark' : 'oxide'),
        content_css: (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'default'),
        branding: false,
        promotion: false,
        link_default_target: '_blank',
        link_assume_external_targets: true,
        paste_data_images: true,
        image_advtab: true,
        codesample_languages: [
            { text: 'Python', value: 'python' },
            { text: 'HTML/XML', value: 'markup' },
            { text: 'JavaScript', value: 'javascript' },
            { text: 'CSS', value: 'css' },
            { text: 'Bash', value: 'bash' },
            { text: 'SQL', value: 'sql' }
        ],
        setup: function(editor) {
            editor.on('change', function() {
                editor.save();
            });
        }
    });
</script>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">{% if is_new %}Create New Wiki Page{% else %}Edit Wiki Page{% endif %}</h4>
                </div>
                <div class="card-body">
                    <form method="POST">
                        {{ form.csrf_token }}
                        
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="title" class="form-label">Title</label>
                                {{ form.title(class="form-control", placeholder="Enter page title") }}
                                {% if form.title.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.title.errors %}
                                    <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-4">
                                <label for="category_id" class="form-label">Category</label>
                                {{ form.category_id(class="form-select") }}
                                {% if form.category_id.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.category_id.errors %}
                                    <span>{{ error }}</span>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="content" class="form-label">Content</label>
                            {{ form.content(class="form-control") }}
                            {% if form.content.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.content.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('wiki.wiki_home') }}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">
                                {% if is_new %}Create Page{% else %}Save Changes{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 